---
layout: page
title: "大数据性能优化之我见"
date: 2020-03-1
author: ynwa
category: up
tags: stars
finished: false
---



### 先讲方法论

性能优化分为3个层面

1. 数仓层面，有导出模式、聚集模式
2. 存储层面，有分表分区设计、文件存储以压缩格式存储、索引设计
3. 计算层面，就是MR、spark、hive等等的优化，往往技术面会涉及到这点

为什么要问性能问题？



实践上来说，性能有2类问题：单个任务和任务链。单个任务，就是从方法论上从3个层面择优实现；任务链，就涉及到优化目标以及相应的策略。

1. 目标是更快完成：分析任务链上所有任务的耗时，抓大解决
2. 目标是更早完成：分析任务链在最晚开始的任务，并尝试提前



### 再讲落地

MR的原理，数仓层面更多的是和SQL打交道，所以为什么需要了解MR的原理呢，这就和hive有关了。那么hive是什么？

可以这么理解hive，hive是一个SQL执行引擎，它负责将Hadoop集群中的文件映射为矩阵表，然后保存元数据，将查询矩阵表的sql翻译为MR任务。所以，我们需要了解的是

1. sql翻译后会得到怎样的MR任务
2. 如果这些MR任务存在性能任务，如何定位到我们的sql中，如果所有的性能问题都直接定位到MR的调优，那么用SQL作为数仓主要开发语言的意义就丢失了

MR算法在Hadoop中，完整的步骤是，input 、map、shuffle、reduce、output，再往细了讲，就需要针对一条sql进行拆解，会涉及到哪些MR步骤



### 数据倾斜

实际上，性能问题有2种：阻断和可接受，如果数据量不大、集群资源足够，所有的任务都会按预期的产出，往往也很难觉察到数据倾斜问题。

所谓的阻断性质的数据倾斜问题，会导致任务无法产出或者偶发的出现失败现象。这个时候，就真正触及到MR原理的本质。好了，讲了这么久的数据倾斜问题，那么什么是数据倾斜，对MR来说，